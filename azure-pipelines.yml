trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  nodeVersion: '18.x'
  # Переменные токенов, клиент-идентификаторы и т.д.
  TELEGRAM_BOT_TOKEN: '$(TELEGRAM_BOT_TOKEN)'
  TWITCH_CLIENT_ID: '$(TWITCH_CLIENT_ID)'
  TWITCH_CLIENT_SECRET: '$(TWITCH_CLIENT_SECRET)'
  TELEGRAM_CHANNEL_ID: '$(TELEGRAM_CHANNEL_ID)'

steps:
  - task: UseNode@1
    inputs:
      version: $(nodeVersion)
    displayName: 'Install Node.js'

  - script: |
      npm ci
    displayName: 'Install dependencies'

  - script: |
      npm run lint
    displayName: 'Lint'

  - script: |
      npm test
    displayName: 'Run tests'

  - script: |
      npm run build
    displayName: 'Build'

  # Копирование собранных файлов в артефактную папку (если нужен артефакт)
  - task: CopyFiles@2
    inputs:
      sourceFolder: '$(Build.SourcesDirectory)'
      contents: |
        index.js
        dist/**/*
        package*.json
      targetFolder: '$(Build.ArtifactStagingDirectory)'
    displayName: 'Prepare artifact'

  - task: PublishPipelineArtifact@1
    inputs:
      artifactName: 'twitch-notifier'
      targetPath: '$(Build.ArtifactStagingDirectory)'
    displayName: 'Publish artifact'
